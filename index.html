<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Bispo-Brito</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Finanças AI">
    <link rel="apple-touch-icon" href="icon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.21.0",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js",
    "firebase/": "https://aistudiocdn.com/firebase@^12.5.0/"
  }
}
</script>
</head>
<body>
    <div id="app-container">
        <!-- Input oculto para upload de foto -->
        <input type="file" id="profileUploadInput" accept="image/*" style="display: none;">

        <!-- NEW HEADER LAYOUT -->
        <header class="header">
            <div class="header-top-row">
                <!-- Left Column: Menu + Greeting -->
                <div class="header-left-col">
                    <button id="menuBtn" class="icon-btn menu-btn-small">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                    </button>
                    <button id="backBtn" class="icon-btn menu-btn-small" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    </button>
                    <div id="headerGreeting" class="greeting-huge">
                        <div class="couple-avatar" id="coupleAvatarBtn" title="Clique para trocar a foto">
                            <img id="profileImageDisplay" src="profile.jpg" alt="Perfil Casal" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjM2I4MmY2IiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PGNpcmNsZSBjeD0iMTIiIGN5PSI4IiByPSI0Ii8+PHBhdGggZD0iTTUgMjBhNyA3IDAgMCAxIDE0IDB2MSIvPjwvc3ZnPg=='">
                            <div class="edit-overlay"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg></div>
                        </div>
                        Olá, Casal!
                    </div>
                </div>

                <!-- Right Column: Date + Actions -->
                <div class="header-right-col">
                    <div id="currentDateDisplay" class="date-top-right">...</div>
                    <div class="header-mini-actions">
                        <div id="syncStatusIndicator" class="sync-indicator offline" title="Status de Sincronização">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.5 19A3.5 3.5 0 0 0 21 15.5c0-1.87-1.46-3.41-3.32-3.49A5.5 5.5 0 0 0 12 7a5.48 5.48 0 0 0-4.68 2.61A3.5 3.5 0 0 0 4 13.5C4 15.43 5.57 17 7.5 17h10"></path></svg>
                        </div>
                        <button id="import-btn-header" class="icon-btn" title="Importar Extrato/Print">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        </button>
                        <button id="open-ai-btn-header" class="icon-btn ai-btn" title="IA Financeira">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>
                        </button>
                    </div>
                </div>
            </div>

            <div class="header-balance-section-large">
                <span class="balance-label">Saldo disponível</span>
                <div class="balance-wrapper-large">
                    <span id="headerBalanceValue" class="balance-value-huge">R$ 0,00</span>
                    <button id="toggleBalanceBtn" class="icon-btn toggle-eye">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
            </div>

            <div class="month-selector-bar">
                <button class="month-btn prev-month">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                </button>
                <span id="monthDisplay" class="month-display">Mês Atual</span>
                <button class="month-btn next-month">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </div>
        </header>

        <!-- SIDEBAR -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Menu</h2>
                <button id="closeSidebarBtn" class="action-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="sidebar-content">
                <div class="section">
                    <div class="section-header"><h2 class="section-title">Contas</h2></div>
                    <div id="bankAccountsList"></div>
                    <div class="accounts-total"><span>Saldo Total</span><span id="accountsTotalValue">R$ 0,00</span></div>
                    <div style="padding: 1.5rem;"><button id="add-account-btn" class="btn btn-secondary" style="width: 100%; justify-content: center;"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>Adicionar Conta</button></div>
                </div>
                <div class="section">
                    <div class="section-header"><h2 class="section-title">Nuvem & Backup</h2></div>
                    <div class="sync-config-section">
                        <p><strong>Status:</strong> <span id="sync-status-text">Conectando...</span></p>
                        <p id="sync-status-info" style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 1rem;">O backup é automático e ocorre a cada mudança.</p>
                        <button id="sync-btn" class="sync-btn-sidebar">Forçar Sincronização</button>
                    </div>
                </div>
            </div>
        </div>

        <main id="main-content">
            <!-- HOME VIEW -->
            <div id="view-home" class="app-view active">
                <div class="info-cards-grid">
                    <!-- SEÇÃO 1: SALÁRIO E DESPESAS GERAIS -->
                    <div id="card-salary" class="summary-card card-bg-success">
                        <div class="summary-header"><div class="summary-title">Entrada de Salários</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="salaryTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total Previsto</div>
                        <div class="summary-progress-bar"><div id="salaryIncomeProgressBar" class="summary-progress-bar-inner income"></div></div>
                        <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Recebido</span>
                                 <span id="salaryIncome" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Receber</span>
                                 <span id="salaryPendingValue" class="stat-val warning">R$ 0,00</span>
                             </div>
                        </div>
                    </div>

                    <div id="card-expenses" class="summary-card card-bg-danger">
                        <div class="summary-header"><div class="summary-title">Despesas Fixas e Variáveis</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="expensesTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total de Contas</div>
                        <div class="summary-progress-bar"><div id="fixedVariableExpensesProgressBar" class="summary-progress-bar-inner expense"></div></div>
                         <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Pago</span>
                                 <span id="fixedVariableExpenses" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Pagar</span>
                                 <span id="expensesPendingValue" class="stat-val danger">R$ 0,00</span>
                             </div>
                        </div>
                    </div>

                    <div id="card-remainder" class="summary-card card-bg-blue-balance">
                        <div class="summary-header"><div class="summary-title">Balanço Salário</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="salaryRemainder" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Livre após contas</div>
                        <div class="summary-progress-bar"><div id="salaryRemainderProgressBar" class="summary-progress-bar-inner income"></div></div>
                    </div>

                    <div class="card-separator"></div>

                    <!-- SEÇÃO 2: MUMBUCA -->
                    <div id="card-mumbuca-income" class="summary-card card-bg-success">
                        <div class="summary-header"><div class="summary-title">Entrada Mumbuca</div></div>
                        <div class="summary-main">
                             <span class="currency-symbol">R$</span>
                             <span id="mumbucaTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total Previsto</div>
                        <div class="summary-progress-bar"><div id="mumbucaIncomeProgressBar" class="summary-progress-bar-inner income"></div></div>
                        <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Recebido</span>
                                 <span id="mumbucaIncome" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Receber</span>
                                 <span id="mumbucaPendingValue" class="stat-val warning">R$ 0,00</span>
                             </div>
                        </div>
                    </div>

                    <div id="card-mumbuca-expenses" class="summary-card card-bg-danger">
                        <div class="summary-header"><div class="summary-title">Gastos com Mumbuca</div></div>
                        <div class="summary-main">
                             <span class="currency-symbol">R$</span>
                             <span id="mumbucaExpensesTotalDisplay" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Total de Gastos</div>
                        <div class="summary-progress-bar"><div id="mumbucaExpensesProgressBar" class="summary-progress-bar-inner expense"></div></div>
                         <div class="stats-grid">
                             <div class="stat-box">
                                 <span class="stat-label">Já Pago</span>
                                 <span id="mumbucaExpenses" class="stat-val success">R$ 0,00</span>
                             </div>
                             <div class="stat-box">
                                 <span class="stat-label">A Pagar</span>
                                 <span id="mumbucaExpensesPendingValue" class="stat-val danger">R$ 0,00</span>
                             </div>
                        </div>
                    </div>

                    <div id="card-mumbuca-balance" class="summary-card card-bg-blue-balance">
                        <div class="summary-header"><div class="summary-title">Balanço Mumbuca</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="mumbucaBalance" class="main-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Saldo Atual</div>
                        <div class="summary-progress-bar"><div id="mumbucaBalanceProgressBar" class="summary-progress-bar-inner income"></div></div>
                    </div>

                    <div class="general-separator"></div>

                    <div id="card-general-income" class="summary-card card-bg-success">
                        <div class="summary-header"><div class="summary-title">Total Geral Entradas</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="generalTotalIncome" class="main-amount income-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Soma de todas as entradas</div>
                    </div>

                    <div id="card-general-expenses" class="summary-card card-bg-danger">
                        <div class="summary-header"><div class="summary-title">Total Geral Saídas</div></div>
                        <div class="summary-main">
                            <span class="currency-symbol">R$</span>
                            <span id="generalTotalExpenses" class="main-amount expense-amount">0,00</span>
                        </div>
                        <div class="summary-subtitle">Soma de todas as saídas</div>
                    </div>

                    <!-- CARD REPASSES (DINÂMICO) -->
                    <div id="repassesDynamicContainer" class="repasses-grid"></div>
                </div>

                <div id="debtSummaryContainer"></div>
            </div>

            <!-- LANÇAMENTOS VIEW -->
            <div id="view-lancamentos" class="app-view">
                <div class="segmented-control">
                    <button class="segmented-btn active" data-list="incomes">Entradas</button>
                    <button class="segmented-btn" data-list="expenses">Despesas</button>
                    <button class="segmented-btn" data-list="compras-mumbuca">Compras Mumbuca</button>
                    <button class="segmented-btn" data-list="abastecimento-mumbuca">Abastecimento</button>
                    <button class="segmented-btn" data-list="avulsos">Avulsos</button>
                </div>

                <div class="lists-container">
                    <div id="list-incomes" class="list-view" style="display: block;">
                         <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-income-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Entrada
                             </button>
                         </div>
                         <div id="incomesList" class="items-list"></div>
                    </div>
                    <div id="list-expenses" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-expense-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Despesa
                             </button>
                        </div>
                        <div id="expensesList" class="items-list"></div>
                    </div>
                    <div id="list-compras-mumbuca" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-compras-mumbuca-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Compra
                             </button>
                        </div>
                        <div id="comprasMumbucaList" class="items-list"></div>
                    </div>
                    <div id="list-abastecimento-mumbuca" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-abastecimento-mumbuca-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Abastecimento
                             </button>
                        </div>
                        <div id="abastecimentoMumbucaList" class="items-list"></div>
                    </div>
                    <div id="list-avulsos" class="list-view" style="display: none;">
                        <div style="padding: 1rem 0; display: flex; justify-content: flex-end;">
                             <button id="add-avulso-btn" class="btn btn-secondary">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                 Adicionar Avulso
                             </button>
                        </div>
                        <div id="avulsosList" class="items-list"></div>
                    </div>
                </div>
            </div>

            <!-- GOALS VIEW -->
            <div id="view-goals" class="app-view">
                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Metas de Gastos</h2>
                        <button id="add-goal-btn" class="icon-btn" title="Adicionar Meta">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="goalsList" class="goals-list"></div>
                </div>

                <div class="section">
                    <div class="section-header">
                        <h2 class="section-title">Metas de Economia</h2>
                        <button id="add-savings-goal-btn" class="icon-btn" title="Adicionar Meta de Poupança">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <div id="savingsGoalsList" class="goals-list"></div>
                </div>
            </div>

        </main>

        <!-- Modals -->
        <div id="importModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Importar Dados</h2>
                    <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <textarea id="importText" class="form-input" rows="8" placeholder="Cole aqui seu extrato..."></textarea>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                    <button type="button" id="processImportBtn" class="btn">Processar</button>
                </div>
            </div>
        </div>

        <div id="addModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Adicionar Transação</h2>
                    <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <form id="addForm">
                    <div class="form-group"><label class="form-label" for="description">Descrição</label><input type="text" name="description" class="form-input" required></div>
                    <div class="form-group"><label class="form-label" for="amount">Valor (R$)</label><input type="text" name="amount" class="form-input" required inputmode="decimal"></div>
                    <div class="form-group"><label class="form-label" for="category">Categoria</label><select id="category" name="category" class="form-select"></select></div>
                    <div class="form-group"><label class="form-label" for="sourceAccount">Conta</label><select id="sourceAccount" name="sourceAccount" class="form-select"></select></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-modal-btn">Cancelar</button>
                        <button type="submit" class="btn">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Editar Item</h2>
                    <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <form id="editForm">
                    <input type="hidden" id="editItemId" name="itemId">
                    <input type="hidden" id="editItemType" name="itemType">
                    <div class="form-group"><label class="form-label" for="editDescription">Descrição</label><input type="text" id="editDescription" name="description" class="form-input" required></div>
                    <div class="form-group"><label class="form-label" for="editAmount">Valor (R$)</label><input type="text" id="editAmount" name="amount" class="form-input" required inputmode="decimal"></div>
                    <div class="form-group"><label class="form-label" for="editCategory">Categoria</label><select id="editCategory" name="category" class="form-select"></select></div>
                    <div class="form-group"><label class="form-label" for="editSourceAccount">Conta</label><select id="editSourceAccount" name="sourceAccount" class="form-select"></select></div>
                    <div class="modal-footer">
                        <button type="button" id="deleteItemBtn" class="btn btn-danger">Excluir</button>
                        <button type="submit" class="btn">Salvar</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="aiModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">IA Financeira</h2>
                    <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                </div>
                <div id="aiAnalysis"></div>
                <div class="ai-footer">
                    <form id="aiChatForm">
                        <input type="text" id="aiChatInput" class="form-input" placeholder="Pergunte sobre suas finanças...">
                        <button type="submit" class="btn">Enviar</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="goalModal" class="modal">
             <div class="modal-content">
                 <div class="modal-header">
                     <h2 class="modal-title">Meta de Gastos</h2>
                     <button class="action-btn close-modal-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                 </div>
                 <form id="goalForm">
                     <input type="hidden" id="goalId" name="goalId">
                     <div class="form-group"><label class="form-label" for="goalCategory">Categoria</label><select id="goalCategory" name="category" class="form-select" required></select></div>
                     <div class="form-group"><label class="form-label" for="goalAmount">Limite Mensal (R$)</label><input type="text" id="goalAmount" name="goalAmount" class="form-input" required inputmode="decimal"></div>
                     <div class="modal-footer"><button type="submit" class="btn">Salvar Meta</button></div>
                 </form>
             </div>
        </div>

        <nav id="tab-bar">
            <button class="tab-btn active" data-view="home">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                Início
            </button>
            <button class="tab-btn" data-view="lancamentos">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                Lançamentos
            </button>
            <button class="tab-btn" data-view="goals">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>
                Metas
            </button>
        </nav>
        
    </div>
    
    <script type="module" src="index.tsx"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed:', registrationError);
                    });
            });
        }
    </script>
</body>
</html>